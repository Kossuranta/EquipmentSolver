<div class="general-info">
  <div class="info-row">
    @if (profile.gameCoverUrl) {
      <img [src]="profile.gameCoverUrl" [alt]="profile.gameName" class="game-cover-large" />
    }
    <div class="info-details">
      <h2>{{ profile.name }}</h2>
      <p class="meta">{{ profile.gameName }} &middot; Version {{ profile.version }} &middot; Created {{ profile.createdAt | date: 'mediumDate' }}</p>

      @if (!editing()) {
        @if (profile.description) {
          <p class="description">{{ profile.description }}</p>
        } @else {
          <p class="description no-description">No description</p>
        }

        @if (isOwner) {
          <div class="visibility-toggle">
            <mat-slide-toggle
              [checked]="profile.isPublic"
              (change)="toggleVisibility()"
              [disabled]="togglingVisibility()"
              matTooltip="Make this profile discoverable by other users"
            >
              {{ profile.isPublic ? 'Public' : 'Private' }}
            </mat-slide-toggle>
          </div>

          <button mat-button (click)="startEditing()">
            <mat-icon>edit</mat-icon>
            Edit Profile
          </button>
        }
      } @else {
        @if (error()) {
          <p class="error-message">{{ error() }}</p>
        }
        <form [formGroup]="form" class="edit-form">
          <mat-form-field class="full-width">
            <mat-label>Profile Name</mat-label>
            <input matInput formControlName="name" />
            @if (form.get('name')?.hasError('required')) {
              <mat-error>Profile name is required</mat-error>
            } @else if (form.get('name')?.hasError('maxlength')) {
              <mat-error>Profile name must be at most 100 characters</mat-error>
            }
            <mat-hint align="end">{{ form.value.name?.length ?? 0 }}/100</mat-hint>
          </mat-form-field>
          <mat-form-field class="full-width">
            <mat-label>Description</mat-label>
            <textarea
              matInput
              formControlName="description"
              rows="3"
              placeholder="e.g., PvP build, Max magic resist..."
            ></textarea>
            <mat-hint align="end">{{ form.value.description?.length ?? 0 }}/500</mat-hint>
          </mat-form-field>
          <div class="edit-actions">
            <button mat-button (click)="cancelEditing()" [disabled]="saving()">Cancel</button>
            <button mat-flat-button (click)="save()" [disabled]="saving() || form.invalid">
              @if (saving()) {
                <mat-spinner diameter="20"></mat-spinner>
              } @else {
                Save
              }
            </button>
          </div>
        </form>
      }
    </div>
  </div>
</div>
